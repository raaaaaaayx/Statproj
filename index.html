<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AP Statistics Student Quality Simulation</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
    <!-- Updated Chart.js CDN -->
    <script src="https://unpkg.com/chart.js@4.4.3/dist/chart.umd.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2, h3 {
            color: #333;
        }
        button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 10px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        .hidden {
            display: none;
        }
        canvas {
            max-width: 100%;
            height: auto !important;
        }
        .simulation-log {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .definition-box, .procedure-box {
            background: #e9f7ef;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        input[type="number"] {
            padding: 8px;
            width: 100px;
        }
        /* New styles for chart containers to fix infinite height bug */
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AP Statistics Unit 4 Simulation Project</h1>
        <p><em>By Ray Xu, McQueen Hong, Nicole Wang, Lucas Pan</em></p>

        <!-- Definition Section -->
        <div class="definition-box">
            <h2>Definition</h2>
            <p>A students quality can be an integer from 0 to 9. A school’s quality can be determined as “Good”, “Regular” and “Bad”. A good school has a 40% chance of improving a student's quality by 1(if possible), 30% chance of keeping it the same, 20% chance of reducing the quality by 1 and 10% chance of keeping it the same but repeat a year. For a regular school, the percentages are 30%, 40%, 20%, and 10%, respectively. For a bad school, they are 20%, 30%, 30%, and 20%</p>
            <p>In terms of python, For “Good” it is 40% that a student’s quality+1, 40% keeping the same score, 20% −1 score. In addition to that, since we are not showing how many years they have spent in school, the probability of repeating a year can be equally separated among the other 3 because they need to repeat the step of getting a+-same score.</p>
            <p>So,</p>
            <p>For a Good School:<br>
            •+1: P(0.4333)<br>
            •+0: P(0.3333)<br>
            • −1: P(0.2333)</p>
            <p>For a Regular School:<br>
            •+1: P(0.3333)<br>
            •+0: P(0.4333)<br>
            • −1: P(0.2333)</p>
            <p>For a Bad School:<br>
            •+1: P(0.2667)<br>
            •+0: P(0.3667)<br>
            • −1: P(0.3667)</p>
        </div>

        <!-- Procedure Section -->
        <div class="procedure-box">
            <h2>Procedure</h2>
            <ol>
                <li>For each students, they will be assigned a random integer between 2-6 by “random.choice([2, 3, 4, 5, 6]).” It is definitely random since it is processed by code so there will be no bias.</li>
                <li>These students are randomly assigned to different schools(from k-5 total of 6 years). This process is done by:
                    <pre>r= random.random()
if r&lt; 0.3: elem_school='G' elif r&lt; 0.3+ 0.4: elem_school='R' else: elem_school= ‘B'</pre>
                    The code above will generate any number between 0 to 1, then base on the number generated, students below 0.3 will go to a good primary school, students who have a number below 0.7 will go to a regular primary school, students with a number of 0.7 and above will go to a bad primary school.
                </li>
                <li>Every year, these students will+-1 or keep their quality score the same by the probability determined above in the definition section. This process will be done by:
                    <pre>up, same, down= probs[school] r= random.random()
if r&lt; down:
return clamp(q- 1)
elif r&lt; down+ same: return q else:
return clamp(q+ 1)</pre>
                    Clamp is a def where score will be stored and keep the score in the range from 0-9. R-value will be a random number between 0-1, and based on the P-value for each school a score+-1 or same will be determined.
                </li>
                <li>Base on the quality score after grade 5, these students will be assigned to their middle school by: <pre>def assign(q): return'G' if q&gt;= 7 else'R' if q&gt;= 3 else ‘B'</pre></li>
                <li>During the middle school period, process 3 will repeat.</li>
                <li>After 3 years of middle school, process 4 will repeat to determine which student should get into what kind of high school.</li>
                <li>During the high school period, process 3 will repeat.</li>
                <li>The final output would be a list of numbers that determine the final quality score of each students by:
                    <pre>result= get_final_qualities(n) print(result)</pre>
                    n-value is the number of students participant, print will give you the result.
                </li>
            </ol>
        </div>

        <!-- Simulation Controls -->
        <label for="student-count">Number of Students to Simulate:</label>
        <input type="number" id="student-count" name="student-count" min="1" max="10000" value="4000">
        <button onclick="runSimulation()">Run Simulation</button>

        <div id="results-section" class="hidden">
            <h2>Simulation Results</h2>
            <div class="stats-grid" id="stats-container"></div>
            <div>
                <h3>Population Distribution</h3>
                <!-- Fixed: Wrapped canvas in a container with fixed height -->
                <div class="chart-container">
                    <canvas id="histogram-chart"></canvas>
                </div>
            </div>
            <button onclick="simulateSingleStudent()">Simulate a Single Student's Journey</button>
        </div>

        <div id="single-student-section" class="hidden">
            <h2>Single Student Simulation</h2>
            <div id="journey-log" class="simulation-log"></div>
            <div>
                <h3>Quality Progression</h3>
                <!-- Fixed: Wrapped canvas in a container with fixed height -->
                <div class="chart-container">
                    <canvas id="progression-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ... (All your existing JavaScript functions remain exactly the same) ...

        // Visualization
        let histogramChart = null;
        let progressionChart = null;

        function renderHistogram(data) {
            const ctx = document.getElementById('histogram-chart').getContext('2d');
            if (histogramChart) histogramChart.destroy();

            // Count frequencies for bins 0-9
            const bins = Array(10).fill(0);
            data.forEach(val => bins[val]++);

            histogramChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: bins.map((_, i) => i.toString()),
                    datasets: [{
                        label: 'Frequency',
                         bins,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    // Fixed: Added maintainAspectRatio: false
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 1 }
                        },
                        x: {
                            title: { display: true, text: 'Final Quality Score' }
                        }
                    }
                }
            });
        }

        function renderProgressionChart(scores) {
            const ctx = document.getElementById('progression-chart').getContext('2d');
            if (progressionChart) progressionChart.destroy();

            progressionChart = new Chart(ctx, {
                type: 'line',
                 {
                    labels: Array.from({length: scores.length}, (_, i) => i+1),
                    datasets: [{
                        label: 'Quality Score',
                         scores,
                        fill: false,
                        borderColor: 'rgb(75, 192, 192)',
                        tension: 0.1
                    }]
                },
                options: {
                    // Fixed: Added maintainAspectRatio: false
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 9,
                            ticks: { stepSize: 1 }
                        },
                        x: {
                            title: { display: true, text: 'Year' }
                        }
                    }
                }
            });
        }

        // ... (The rest of your JavaScript functions remain exactly the same) ...
    </script>
</body>
</html>
